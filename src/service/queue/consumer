#!/usr/bin/env bash

# opens a fifo pipe at the given path and then executes the given command using
# arguments pushed to the pipe, or echos the arguments, if no command is given

fifo="$1"
cmd="$2"
kill_switch="kill"

# rm fifo_name at exit
trap "rm -f $fifo" EXIT

[[ -p "$fifo" ]] || mkfifo "$fifo"

while true; do
    if read -r arg < $fifo; then
        [[ "$arg" = "$kill_switch" ]] && break

        if [[ -n "$cmd" ]]; then
            # execute the given command using the received argument
            /usr/bin/env bash -c "$cmd $arg"
        else
            echo "$arg"
        fi
    fi
done

exit 0
